import{a as f,p as h,q as y,u as U,w as T}from"./chunk-UHN6TUEN.js";import{F as k,Fc as x,H as R,Z as C,a as I,b,ea as p,f as s,g as c,h as v,i as j,ka as n,o as F,qb as u,sb as S,u as g,x as w,y as P}from"./chunk-74Y5P3YM.js";var A=(()=>{let e=class e{constructor(){this.onMessage=new F,this.initialize()}initialize(){this.channel=new BroadcastChannel("qr-login"),this.channel.onmessage=t=>this.onMessage.next(t.data)}ngOnDestroy(){this.channel?.close()}publish(t){this.channel?.postMessage(t)}receiverInitialized(){this.publish({type:"notifyReady"})}messagesOfType(t){return this.onMessage.pipe(R(r=>r.type===t))}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var D=(()=>{var e,i;let t=class t{constructor(){c(this,e,n(h));c(this,i,n(f))}getEvaluations(){return s(this,i).get(s(this,e)+"evaluation")}getWinners(){return s(this,i).get(s(this,e)+"evaluation/winners")}};e=new WeakMap,i=new WeakMap,t.\u0275fac=function(l){return new(l||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var L=(()=>{var e,i;let t=class t{constructor(){c(this,e,n(h));c(this,i,n(f))}getStations(){return s(this,i).get(s(this,e)+"penalty/stations")}getTeams(a){return s(this,i).get(s(this,e)+"penalty/teams/station/"+a)}createPenalty(a){return s(this,i).post(s(this,e)+"penalty",a)}getPenalties(a){return s(this,i).get(s(this,e)+"penalty/list/"+a)}delete(a){return s(this,i).delete(s(this,e)+"penalty/"+a,{responseType:"text"})}hasPrivileges(a){return s(this,i).get(`${s(this,e)}penalty/${a}/checkPrivileges`)}};e=new WeakMap,i=new WeakMap,t.\u0275fac=function(l){return new(l||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var et=(()=>{var e,i;let t=class t{constructor(){c(this,e,n(h));c(this,i,n(f))}create(a){return s(this,i).post(s(this,e)+"completion/team",a,{responseType:"text"})}get(a){return s(this,i).get(`${s(this,e)}track/team/${a}`)}};e=new WeakMap,i=new WeakMap,t.\u0275fac=function(l){return new(l||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var pt=(()=>{var e,i,t;let r=class r{constructor(){c(this,e,n(h)+"track/checkIn");c(this,i,n(f));c(this,t,n(y))}checkIn(l){return l!==s(this,e)?g(()=>"QR-Code nicht g\xFCltig!"):s(this,i).post(s(this,e),s(this,t).user()?.uuid)}};e=new WeakMap,i=new WeakMap,t=new WeakMap,r.\u0275fac=function(d){return new(d||r)},r.\u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var gt=(()=>{var e,i,t;let r=class r{constructor(){c(this,e,n(h)+"track/checkOut");c(this,i,n(f));c(this,t,n(y))}checkOut(l){return s(this,i).post(s(this,e),l)}validatedCheckOut(l){return l!==s(this,e)?g(()=>"QR-Code nicht g\xFCltig!"):this.checkOut(s(this,t).user()?.uuid)}};e=new WeakMap,i=new WeakMap,t=new WeakMap,r.\u0275fac=function(d){return new(d||r)},r.\u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var H=(()=>{var e,i;let t=class t{constructor(){c(this,e,n(h));c(this,i,n(f))}getRegistrations(){return s(this,i).get(s(this,e)+"completion/registrations")}};e=new WeakMap,i=new WeakMap,t.\u0275fac=function(l){return new(l||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var O=(()=>{var e;let i=class i{constructor(){c(this,e,void 0);v(this,e,n(h)),this.http=n(f)}getRaceStats(){return this.http.get(`${s(this,e)}racestats`)}};e=new WeakMap,i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var $t=(()=>{let e=class e{constructor(){this.onboardingService=n(H),this.registrations=u([]),this.filterOnboarded=u(!1),this.filteredRegistrations=x(()=>{if(this.filterOnboarded()){let t=this.registrations().filter(r=>!r.hasTeam);return this.applyFilter(t)}else return this.applyFilter(this.registrations())}),this.nameFilter=u(""),this.selectedFilter=S("name")}loadRegistrations(){this.onboardingService.getRegistrations().subscribe(t=>{this.registrations.set(t)})}setHasTeam(t){this.registrations.update(r=>r.map(a=>a.uuid===t?b(I({},a),{hasTeam:!0}):a))}toggleFilterOnboarded(){this.filterOnboarded.set(!this.filterOnboarded())}applyFilter(t){return this.selectedFilter()==="name"?t.filter(r=>this.filterByName(r,this.nameFilter())):this.selectedFilter()==="boxId"?t.filter(r=>this.filterBoxId(r)):t}filterByName(t,r){return t.participant1.fullName.toLowerCase().includes(r.toLowerCase())||t.participant2.fullName.toLowerCase().includes(r.toLowerCase())}filterBoxId(t){return t.boxId?this.nameFilter()===""?t:t.boxId===parseInt(this.nameFilter()):null}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var Dt=(()=>{let e=class e{constructor(){this.raceStatsService=n(O),this.refreshingRaceStats$=k(0,1e4).pipe(C(()=>this.raceStatsService.getRaceStats()))}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var Xt=(()=>{let e=class e{constructor(){this.penaltyService=n(L),this.toastr=n(T),this.stations=U(this.penaltyService.getStations(),{initialValue:[]}),this.teams=u([]),this.filteredTeams=x(()=>this.teams().filter(t=>!this.recordedPenalties().some(r=>r.teamBoxId===t.boxId))),this.boxIds=x(()=>this.filteredTeams().map(t=>t.boxId).sort((t,r)=>t-r)),this.recordedPenalties=u([])}loadTeams(t){this.penaltyService.getTeams(t).pipe(P(r=>r.sort((a,l)=>a.registration.participant1.fullName.localeCompare(l.registration.participant2.fullName)))).subscribe(r=>this.teams.set(r))}loadPenalties(t){this.penaltyService.getPenalties(t).subscribe(r=>this.recordedPenalties.set(r))}createPenalty(t,r){this.penaltyService.createPenalty(t).subscribe({next:a=>{this.recordedPenalties.set([...this.recordedPenalties(),a]),this.toastr.success(`Die ${r} wurden erfolgreich erfasst!`,"Erfolgreich")},error:a=>{this.toastr.error(a.error,"Fehler")}})}deletePenalty(t,r,a){this.penaltyService.delete(r).subscribe({next:()=>{this.toastr.success(`Die ${a} wurden erfolgreich gel\xF6scht!`,"Erfolgreich"),this.recordedPenalties.update(l=>l.filter(d=>d.id!==r)),this.loadTeams(t)},error:l=>{this.toastr.error(l.error,"Fehler")}})}hasPrivileges(t){return j(this,null,function*(){return yield w(this.penaltyService.hasPrivileges(t))})}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();export{D as a,et as b,pt as c,gt as d,A as e,$t as f,Dt as g,Xt as h};
