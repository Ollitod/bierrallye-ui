import{a as f,p as m,q as y,u as S,w as U}from"./chunk-Z5PJJYAZ.js";import{Bc as g,F,H as R,Z as C,a as I,b,ea as p,f as s,g as c,h as v,i as j,ka as n,o as w,qb as u,u as x,x as P,y as k}from"./chunk-BV56AXSI.js";var $=(()=>{let e=class e{constructor(){this.onMessage=new w,this.initialize()}initialize(){this.channel=new BroadcastChannel("qr-login"),this.channel.onmessage=t=>this.onMessage.next(t.data)}ngOnDestroy(){this.channel?.close()}publish(t){this.channel?.postMessage(t)}receiverInitialized(){this.publish({type:"notifyReady"})}messagesOfType(t){return this.onMessage.pipe(R(r=>r.type===t))}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var z=(()=>{var e,i;let t=class t{constructor(){c(this,e,n(m));c(this,i,n(f))}getEvaluations(){return s(this,i).get(s(this,e)+"evaluation")}getWinners(){return s(this,i).get(s(this,e)+"evaluation/winners")}};e=new WeakMap,i=new WeakMap,t.\u0275fac=function(l){return new(l||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var T=(()=>{var e,i;let t=class t{constructor(){c(this,e,n(m));c(this,i,n(f))}getStations(){return s(this,i).get(s(this,e)+"penalty/stations")}getTeams(a){return s(this,i).get(s(this,e)+"penalty/teams/station/"+a)}createPenalty(a){return s(this,i).post(s(this,e)+"penalty",a)}getPenalties(a){return s(this,i).get(s(this,e)+"penalty/list/"+a)}delete(a){return s(this,i).delete(s(this,e)+"penalty/"+a,{responseType:"text"})}hasPrivileges(a){return s(this,i).get(`${s(this,e)}penalty/${a}/checkPrivileges`)}};e=new WeakMap,i=new WeakMap,t.\u0275fac=function(l){return new(l||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var tt=(()=>{var e,i;let t=class t{constructor(){c(this,e,n(m));c(this,i,n(f))}create(a){return s(this,i).post(s(this,e)+"completion/team",a,{responseType:"text"})}get(a){return s(this,i).get(`${s(this,e)}track/team/${a}`)}};e=new WeakMap,i=new WeakMap,t.\u0275fac=function(l){return new(l||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var ct=(()=>{var e,i,t;let r=class r{constructor(){c(this,e,n(m)+"track/checkIn");c(this,i,n(f));c(this,t,n(y))}checkIn(l){return l!==s(this,e)?x(()=>"QR-Code nicht g\xFCltig!"):s(this,i).post(s(this,e),s(this,t).user()?.uuid)}};e=new WeakMap,i=new WeakMap,t=new WeakMap,r.\u0275fac=function(d){return new(d||r)},r.\u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var gt=(()=>{var e,i,t;let r=class r{constructor(){c(this,e,n(m)+"track/checkOut");c(this,i,n(f));c(this,t,n(y))}checkOut(l){return s(this,i).post(s(this,e),l)}validatedCheckOut(l){return l!==s(this,e)?x(()=>"QR-Code nicht g\xFCltig!"):this.checkOut(s(this,t).user()?.uuid)}};e=new WeakMap,i=new WeakMap,t=new WeakMap,r.\u0275fac=function(d){return new(d||r)},r.\u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var L=(()=>{var e,i;let t=class t{constructor(){c(this,e,n(m));c(this,i,n(f))}getRegistrations(){return s(this,i).get(s(this,e)+"completion/registrations")}};e=new WeakMap,i=new WeakMap,t.\u0275fac=function(l){return new(l||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var H=(()=>{var e;let i=class i{constructor(){c(this,e,void 0);v(this,e,n(m)),this.http=n(f)}getRaceStats(){return this.http.get(`${s(this,e)}racestats`)}};e=new WeakMap,i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var Ot=(()=>{let e=class e{constructor(){this.onboardingService=n(L),this.registrations=u([]),this.filterOnboarded=u(!1),this.filteredRegistrations=g(()=>this.filterOnboarded()?this.registrations().filter(t=>!t.hasTeam).filter(t=>this.filterByName(t,this.nameFilter())):this.registrations().filter(t=>this.filterByName(t,this.nameFilter()))),this.nameFilter=u("")}loadRegistrations(){this.onboardingService.getRegistrations().subscribe(t=>{this.registrations.set(t)})}setHasTeam(t){this.registrations.update(r=>r.map(a=>a.uuid===t?b(I({},a),{hasTeam:!0}):a))}toggleFilterOnboarded(){this.filterOnboarded.set(!this.filterOnboarded())}filterByName(t,r){return t.participant1.fullName.toLowerCase().includes(r.toLowerCase())||t.participant2.fullName.toLowerCase().includes(r.toLowerCase())}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var zt=(()=>{let e=class e{constructor(){this.raceStatsService=n(H),this.refreshingRaceStats$=F(0,1e4).pipe(C(()=>this.raceStatsService.getRaceStats()))}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var Kt=(()=>{let e=class e{constructor(){this.penaltyService=n(T),this.toastr=n(U),this.stations=S(this.penaltyService.getStations(),{initialValue:[]}),this.teams=u([]),this.filteredTeams=g(()=>this.teams().filter(t=>!this.recordedPenalties().some(r=>r.teamBoxId===t.boxId))),this.boxIds=g(()=>this.filteredTeams().map(t=>t.boxId).sort((t,r)=>t-r)),this.recordedPenalties=u([])}loadTeams(t){this.penaltyService.getTeams(t).pipe(k(r=>r.sort((a,l)=>a.registration.participant1.fullName.localeCompare(l.registration.participant2.fullName)))).subscribe(r=>this.teams.set(r))}loadPenalties(t){this.penaltyService.getPenalties(t).subscribe(r=>this.recordedPenalties.set(r))}createPenalty(t,r){this.penaltyService.createPenalty(t).subscribe({next:a=>{this.recordedPenalties.set([...this.recordedPenalties(),a]),this.toastr.success(`Die ${r} wurden erfolgreich erfasst!`,"Erfolgreich")},error:a=>{this.toastr.error(a.error,"Fehler")}})}deletePenalty(t,r,a){this.penaltyService.delete(r).subscribe({next:()=>{this.toastr.success(`Die ${a} wurden erfolgreich gel\xF6scht!`,"Erfolgreich"),this.recordedPenalties.update(l=>l.filter(d=>d.id!==r)),this.loadTeams(t)},error:l=>{this.toastr.error(l.error,"Fehler")}})}hasPrivileges(t){return j(this,null,function*(){return yield P(this.penaltyService.hasPrivileges(t))})}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();export{z as a,tt as b,ct as c,gt as d,L as e,$ as f,Ot as g,zt as h,Kt as i};
