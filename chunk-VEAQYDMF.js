import{a as f,p as h,r as U,s as y,x as T}from"./chunk-XRKOCIBS.js";import{Bc as g,F as R,H as F,Z as S,a as I,b,ea as p,f as s,g as c,h as v,i as j,ka as n,o as P,qb as u,u as x,x as k,y as w}from"./chunk-ODBFWMRA.js";var A=(()=>{let t=class t{constructor(){this.onMessage=new P,this.initialize()}initialize(){this.channel=new BroadcastChannel("qr-login"),this.channel.onmessage=e=>this.onMessage.next(e.data)}ngOnDestroy(){this.channel?.close()}publish(e){this.channel?.postMessage(e)}receiverInitialized(){this.publish({type:"notifyReady"})}messagesOfType(e){return this.onMessage.pipe(F(o=>o.type===e))}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();var B=(()=>{var t,r;let e=class e{constructor(){c(this,t,n(h));c(this,r,n(f))}getEvaluations(){return s(this,r).get(s(this,t)+"evaluation")}getWinners(){return s(this,r).get(s(this,t)+"evaluation/winners")}};t=new WeakMap,r=new WeakMap,e.\u0275fac=function(l){return new(l||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var C=(()=>{var t,r;let e=class e{constructor(){c(this,t,n(h));c(this,r,n(f))}getStations(){return s(this,r).get(s(this,t)+"penalty/stations")}getTeams(a){return s(this,r).get(s(this,t)+"penalty/teams/station/"+a)}createPenalty(a){return s(this,r).post(s(this,t)+"penalty",a)}getPenalties(a){return s(this,r).get(s(this,t)+"penalty/list/"+a)}delete(a){return s(this,r).delete(s(this,t)+"penalty/"+a,{responseType:"text"})}hasPrivileges(a){return s(this,r).get(`${s(this,t)}penalty/${a}/checkPrivileges`)}};t=new WeakMap,r=new WeakMap,e.\u0275fac=function(l){return new(l||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var tt=(()=>{var t,r;let e=class e{constructor(){c(this,t,n(h));c(this,r,n(f))}create(a){return s(this,r).post(s(this,t)+"completion/team",a,{responseType:"text"})}get(a){return s(this,r).get(`${s(this,t)}track/team/${a}`)}};t=new WeakMap,r=new WeakMap,e.\u0275fac=function(l){return new(l||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var ct=(()=>{var t,r,e;let o=class o{constructor(){c(this,t,n(h)+"track/checkIn");c(this,r,n(f));c(this,e,n(y))}checkIn(l){return l!==s(this,t)?x(()=>"QR-Code nicht g\xFCltig!"):s(this,r).post(s(this,t),s(this,e).user.value?.uuid)}};t=new WeakMap,r=new WeakMap,e=new WeakMap,o.\u0275fac=function(d){return new(d||o)},o.\u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();var gt=(()=>{var t,r,e;let o=class o{constructor(){c(this,t,n(h)+"track/checkOut");c(this,r,n(f));c(this,e,n(y))}checkOut(l){return s(this,r).post(s(this,t),l)}validatedCheckOut(l){return l!==s(this,t)?x(()=>"QR-Code nicht g\xFCltig!"):this.checkOut(s(this,e).user.value?.uuid)}};t=new WeakMap,r=new WeakMap,e=new WeakMap,o.\u0275fac=function(d){return new(d||o)},o.\u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();var H=(()=>{var t,r;let e=class e{constructor(){c(this,t,n(h));c(this,r,n(f))}getRegistrations(){return s(this,r).get(s(this,t)+"completion/registrations")}};t=new WeakMap,r=new WeakMap,e.\u0275fac=function(l){return new(l||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var O=(()=>{var t;let r=class r{constructor(){c(this,t,void 0);v(this,t,n(h)),this.http=n(f)}getRaceStats(){return this.http.get(`${s(this,t)}racestats`)}};t=new WeakMap,r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var $t=(()=>{let t=class t{constructor(){this.onboardingService=n(H),this.registrations=u([]),this.filterOnboarded=u(!1),this.filteredRegistrations=g(()=>this.filterOnboarded()?this.registrations().filter(e=>!e.hasTeam):this.registrations())}loadRegistrations(){this.onboardingService.getRegistrations().subscribe(e=>{this.registrations.set(e)})}setHasTeam(e){this.registrations.update(o=>o.map(a=>a.uuid===e?b(I({},a),{hasTeam:!0}):a))}toggleFilterOnboarded(){this.filterOnboarded.set(!this.filterOnboarded())}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();var Bt=(()=>{let t=class t{constructor(){this.raceStatsService=n(O),this.refreshingRaceStats$=R(0,1e4).pipe(S(()=>this.raceStatsService.getRaceStats()))}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();var Kt=(()=>{let t=class t{constructor(){this.penaltyService=n(C),this.toastr=n(T),this.stations=U(this.penaltyService.getStations(),{initialValue:[]}),this.teams=u([]),this.filteredTeams=g(()=>this.teams().filter(e=>!this.recordedPenalties().some(o=>o.teamBoxId===e.boxId))),this.boxIds=g(()=>this.filteredTeams().map(e=>e.boxId).sort((e,o)=>e-o)),this.recordedPenalties=u([])}loadTeams(e){this.penaltyService.getTeams(e).pipe(w(o=>o.sort((a,l)=>a.registration.participant1.fullName.localeCompare(l.registration.participant2.fullName)))).subscribe(o=>this.teams.set(o))}loadPenalties(e){this.penaltyService.getPenalties(e).subscribe(o=>this.recordedPenalties.set(o))}createPenalty(e,o){this.penaltyService.createPenalty(e).subscribe({next:a=>{this.recordedPenalties.set([...this.recordedPenalties(),a]),this.toastr.success(`Die ${o} wurden erfolgreich erfasst!`,"Erfolgreich")},error:a=>{this.toastr.error(a.error,"Fehler")}})}deletePenalty(e,o,a){this.penaltyService.delete(o).subscribe({next:()=>{this.toastr.success(`Die ${a} wurden erfolgreich gel\xF6scht!`,"Erfolgreich"),this.recordedPenalties.update(l=>l.filter(d=>d.id!==o)),this.loadTeams(e)},error:l=>{this.toastr.error(l.error,"Fehler")}})}hasPrivileges(e){return j(this,null,function*(){return yield k(this.penaltyService.hasPrivileges(e))})}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();export{B as a,tt as b,ct as c,gt as d,H as e,A as f,$t as g,Bt as h,Kt as i};
