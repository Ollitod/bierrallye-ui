import{a as f,p as m,q as x,u as A}from"./chunk-KEOIWYZT.js";import{Ac as y,E as P,G as R,Y as w,a as b,b as I,da as p,f as s,g as c,h as j,ja as a,o as v,pb as d,t as k,u as g,x as M}from"./chunk-WGC2DOC3.js";var C=(()=>{let t=class t{constructor(){this.onMessage=new v,this.initialize()}initialize(){this.channel=new BroadcastChannel("qr-login"),this.channel.onmessage=e=>this.onMessage.next(e.data)}ngOnDestroy(){this.channel?.close()}publish(e){this.channel?.postMessage(e)}receiverInitialized(){this.publish({type:"notifyReady"})}messagesOfType(e){return this.onMessage.pipe(R(r=>r.type===e))}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var z=(()=>{var t,i;let e=class e{constructor(){c(this,t,a(m));c(this,i,a(f))}getEvaluations(){return s(this,i).get(s(this,t)+"evaluation")}};t=new WeakMap,i=new WeakMap,e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var F=(()=>{var t,i;let e=class e{constructor(){c(this,t,a(m));c(this,i,a(f))}getStations(){return s(this,i).get(s(this,t)+"penalty/stations")}getTeams(n){return s(this,i).get(s(this,t)+"penalty/teams/station/"+n)}createPenalty(n){return s(this,i).post(s(this,t)+"penalty",n)}getPenalties(n){return s(this,i).get(s(this,t)+"penalty/list/"+n)}delete(n){return s(this,i).delete(s(this,t)+"penalty/"+n,{responseType:"text"})}};t=new WeakMap,i=new WeakMap,e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var Z=(()=>{var t,i;let e=class e{constructor(){c(this,t,a(m));c(this,i,a(f))}create(n){return s(this,i).post(s(this,t)+"completion/team",n,{responseType:"text"})}get(n){return s(this,i).get(`${s(this,t)}track/team/${n}`)}};t=new WeakMap,i=new WeakMap,e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var at=(()=>{var t,i,e;let r=class r{constructor(){c(this,t,a(m)+"track/checkIn");c(this,i,a(f));c(this,e,a(x))}checkIn(h){return h!==s(this,t)?g(()=>"QR-Code nicht g\xFCltig!"):s(this,i).post(s(this,t),s(this,e).user.value?.uuid)}};t=new WeakMap,i=new WeakMap,e=new WeakMap,r.\u0275fac=function(u){return new(u||r)},r.\u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var dt=(()=>{var t,i,e;let r=class r{constructor(){c(this,t,a(m)+"track/checkOut");c(this,i,a(f));c(this,e,a(x))}checkOut(h){return s(this,i).post(s(this,t),h)}validatedCheckOut(h){return h!==s(this,t)?g(()=>"QR-Code nicht g\xFCltig!"):this.checkOut(s(this,e).user.value?.uuid)}};t=new WeakMap,i=new WeakMap,e=new WeakMap,r.\u0275fac=function(u){return new(u||r)},r.\u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var S=(()=>{var t,i;let e=class e{constructor(){c(this,t,a(m));c(this,i,a(f))}getRegistrations(){return s(this,i).get(s(this,t)+"completion/registrations")}};t=new WeakMap,i=new WeakMap,e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=p({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var U=(()=>{var t;let i=class i{constructor(){c(this,t,void 0);j(this,t,a(m)),this.http=a(f)}getRaceStats(){return this.http.get(`${s(this,t)}/race-stats`)}getMockRaceStats(){return k({started:[...Array(Math.floor(Math.random()*20)+1).keys()],station1:[...Array(Math.floor(Math.random()*20)+1).keys()],station2:[...Array(Math.floor(Math.random()*20)+1).keys()],station3:[...Array(Math.floor(Math.random()*20)+1).keys()],station4:[...Array(Math.floor(Math.random()*20)+1).keys()],station5:[...Array(Math.floor(Math.random()*20)+1).keys()],station6:[...Array(Math.floor(Math.random()*20)+1).keys()],station7:[...Array(Math.floor(Math.random()*20)+1).keys()],station8:[...Array(Math.floor(Math.random()*20)+1).keys()],finished:[...Array(Math.floor(Math.random()*20)+1).keys()]})}};t=new WeakMap,i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var Ct=(()=>{let t=class t{constructor(){this.onboardingService=a(S),this.registrations=d([]),this.filterOnboarded=d(!1),this.filteredRegistrations=y(()=>this.filterOnboarded()?this.registrations().filter(e=>!e.hasTeam):this.registrations())}loadRegistrations(){this.onboardingService.getRegistrations().subscribe(e=>{this.registrations.set(e)})}setHasTeam(e){this.registrations.update(r=>r.map(n=>n.uuid===e?I(b({},n),{hasTeam:!0}):n))}toggleFilterOnboarded(){this.filterOnboarded.set(!this.filterOnboarded())}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var Bt=(()=>{let t=class t{constructor(){this.raceStatsService=a(U),this.refreshingRaceStats$=P(0,1e4).pipe(w(()=>this.raceStatsService.getMockRaceStats()))}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var Kt=(()=>{let t=class t{constructor(){this.penaltyService=a(F),this.toastr=a(A),this.stations=d([]),this.teams=d([]),this.filteredTeams=y(()=>this.teams().filter(e=>!this.recordedPenalties().some(r=>r.teamBoxId===e.boxId))),this.boxIds=y(()=>this.filteredTeams().map(e=>e.boxId).sort((e,r)=>e-r)),this.recordedPenalties=d([]),this.showCreatePenalty=d(!1)}loadStations(){this.penaltyService.getStations().subscribe(e=>this.stations.set(e))}loadTeams(e){this.penaltyService.getTeams(e).pipe(M(r=>r.sort((n,h)=>n.registration.participant1.fullName.localeCompare(h.registration.participant2.fullName)))).subscribe(r=>this.teams.set(r))}loadPenalties(e){this.penaltyService.getPenalties(e).subscribe(r=>this.recordedPenalties.set(r))}createPenalty(e){this.penaltyService.createPenalty(e).subscribe({next:r=>{this.recordedPenalties.set([...this.recordedPenalties(),r]),this.toastr.success("Penalty wurde erfolgreich erfasst!","Erfolgreich")},error:r=>{this.toastr.error(r.error,"Fehler")}})}deletePenalty(e,r){this.penaltyService.delete(r).subscribe({next:n=>{this.toastr.success(n,"Erfolgreich"),this.recordedPenalties.update(h=>h.filter(u=>u.id!==r)),this.loadTeams(e)},error:n=>{this.toastr.error(n.error,"Fehler")}})}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();export{z as a,Z as b,at as c,dt as d,S as e,C as f,Ct as g,Bt as h,Kt as i};
